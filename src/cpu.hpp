#ifndef CPU_HPP
#define CPU_HPP

#include <cstdint>
#include "mmu.hpp"
#include "rom.hpp"

/* This structure allows a simple way to access lo/hi bytes from a 16bit */
/* Example
	reg16_t HL = 0xFFAA;
	uint8_t H = HL.hi;
	uint8_t L = HL.lo;
*/

typedef union {
	struct {
		uint8_t lo;
		uint8_t hi;
	};
	uint16_t word;
} reg16_t;

class CPU {
private:
	MMU mmu;

	void InitializeOpcodeTable ();

public:
	/* Registers */
	reg16_t AF;
	reg16_t BC;
	reg16_t DE;
	reg16_t HL;

	uint16_t SP;
	uint16_t PC;

	/* Flags */
	bool Z, N, H, C;

	uint8_t clockCycles;

	CPU ();
	~CPU ();

	void Initialize ();
	void LoadRom (const Rom& rom);
	void EmulateCycle ();
	void FetchOpcode ();
	void EmulateOpcode ();

private:
	/* Instruction tables */
	void (CPU::*opcodes  [256]) ();
	void (CPU::*opcodesCB[256]) ();

	/* Instructions */
	void op0x00 (); void op0x01 (); void op0x02 (); void op0x03 ();
	void op0x04 (); void op0x05 (); void op0x06 (); void op0x07 ();
	void op0x08 (); void op0x09 (); void op0x0A (); void op0x0B ();
	void op0x0C (); void op0x0D (); void op0x0E (); void op0x0F ();

	void op0x10 (); void op0x11 (); void op0x12 (); void op0x13 ();
	void op0x14 (); void op0x15 (); void op0x16 (); void op0x17 ();
	void op0x18 (); void op0x19 (); void op0x1A (); void op0x1B ();
	void op0x1C (); void op0x1D (); void op0x1E (); void op0x1F ();

	void op0x20 (); void op0x21 (); void op0x22 (); void op0x23 ();
	void op0x24 (); void op0x25 (); void op0x26 (); void op0x27 ();
	void op0x28 (); void op0x29 (); void op0x2A (); void op0x2B ();
	void op0x2C (); void op0x2D (); void op0x2E (); void op0x2F ();

	void op0x30 (); void op0x31 (); void op0x32 (); void op0x33 ();
	void op0x34 (); void op0x35 (); void op0x36 (); void op0x37 ();
	void op0x38 (); void op0x39 (); void op0x3A (); void op0x3B ();
	void op0x3C (); void op0x3D (); void op0x3E (); void op0x3F ();

	void op0x40 (); void op0x41 (); void op0x42 (); void op0x43 ();
	void op0x44 (); void op0x45 (); void op0x46 (); void op0x47 ();
	void op0x48 (); void op0x49 (); void op0x4A (); void op0x4B ();
	void op0x4C (); void op0x4D (); void op0x4E (); void op0x4F ();

	void op0x50 (); void op0x51 (); void op0x52 (); void op0x53 ();
	void op0x54 (); void op0x55 (); void op0x56 (); void op0x57 ();
	void op0x58 (); void op0x59 (); void op0x5A (); void op0x5B ();
	void op0x5C (); void op0x5D (); void op0x5E (); void op0x5F ();

	void op0x60 (); void op0x61 (); void op0x62 (); void op0x63 ();
	void op0x64 (); void op0x65 (); void op0x66 (); void op0x67 ();
	void op0x68 (); void op0x69 (); void op0x6A (); void op0x6B ();
	void op0x6C (); void op0x6D (); void op0x6E (); void op0x6F ();

	void op0x70 (); void op0x71 (); void op0x72 (); void op0x73 ();
	void op0x74 (); void op0x75 (); void op0x76 (); void op0x77 ();
	void op0x78 (); void op0x79 (); void op0x7A (); void op0x7B ();
	void op0x7C (); void op0x7D (); void op0x7E (); void op0x7F ();

	void op0x80 (); void op0x81 (); void op0x82 (); void op0x83 ();
	void op0x84 (); void op0x85 (); void op0x86 (); void op0x87 ();
	void op0x88 (); void op0x89 (); void op0x8A (); void op0x8B ();
	void op0x8C (); void op0x8D (); void op0x8E (); void op0x8F ();

	void op0x90 (); void op0x91 (); void op0x92 (); void op0x93 ();
	void op0x94 (); void op0x95 (); void op0x96 (); void op0x97 ();
	void op0x98 (); void op0x99 (); void op0x9A (); void op0x9B ();
	void op0x9C (); void op0x9D (); void op0x9E (); void op0x9F ();

	void op0xA0 (); void op0xA1 (); void op0xA2 (); void op0xA3 ();
	void op0xA4 (); void op0xA5 (); void op0xA6 (); void op0xA7 ();
	void op0xA8 (); void op0xA9 (); void op0xAA (); void op0xAB ();
	void op0xAC (); void op0xAD (); void op0xAE (); void op0xAF ();

	void op0xB0 (); void op0xB1 (); void op0xB2 (); void op0xB3 ();
	void op0xB4 (); void op0xB5 (); void op0xB6 (); void op0xB7 ();
	void op0xB8 (); void op0xB9 (); void op0xBA (); void op0xBB ();
	void op0xBC (); void op0xBD (); void op0xBE (); void op0xBF ();

	void op0xC0 (); void op0xC1 (); void op0xC2 (); void op0xC3 ();
	void op0xC4 (); void op0xC5 (); void op0xC6 (); void op0xC7 ();
	void op0xC8 (); void op0xC9 (); void op0xCA (); void op0xCB ();
	void op0xCC (); void op0xCD (); void op0xCE (); void op0xCF ();

	void op0xD0 (); void op0xD1 (); void op0xD2 (); void op0xD3 ();
	void op0xD4 (); void op0xD5 (); void op0xD6 (); void op0xD7 ();
	void op0xD8 (); void op0xD9 (); void op0xDA (); void op0xDB ();
	void op0xDC (); void op0xDD (); void op0xDE (); void op0xDF ();

	void op0xE0 (); void op0xE1 (); void op0xE2 (); void op0xE3 ();
	void op0xE4 (); void op0xE5 (); void op0xE6 (); void op0xE7 ();
	void op0xE8 (); void op0xE9 (); void op0xEA (); void op0xEB ();
	void op0xEC (); void op0xED (); void op0xEE (); void op0xEF ();

	void op0xF0 (); void op0xF1 (); void op0xF2 (); void op0xF3 ();
	void op0xF4 (); void op0xF5 (); void op0xF6 (); void op0xF7 ();
	void op0xF8 (); void op0xF9 (); void op0xFA (); void op0xFB ();
	void op0xFC (); void op0xFD (); void op0xFE (); void op0xFF ();

	void opNull ();
};

#endif

// References
// https://wornwinter.wordpress.com/2015/02/14/adventures-in-gameboy-emulation-part-2-the-cpu/
